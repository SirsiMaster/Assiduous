<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Assiduous - Set Up Your Profile</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .onboarding-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .progress-bar {
            height: 6px;
            background: #e0e0e0;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .onboarding-header {
            padding: 40px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }
        
        .step {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #999;
            font-size: 14px;
            font-weight: 600;
        }
        
        .step.active {
            color: #667eea;
        }
        
        .step.completed {
            color: #28a745;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid currentColor;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .step.completed .step-number {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }
        
        .step.active .step-number {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .onboarding-content {
            padding: 40px;
            min-height: 500px;
        }
        
        .step-content {
            display: none;
        }
        
        .step-content.active {
            display: block;
        }
        
        .step-title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }
        
        .step-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
        }
        
        .form-group {
            margin-bottom: 30px;
        }
        
        label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #555;
            margin-bottom: 10px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .price-range {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .checkbox-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .checkbox-item.selected {
            background: #f8f9ff;
            border-color: #667eea;
        }
        
        .preference-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .preference-card {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .preference-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .preference-card.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
        }
        
        .preference-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .preference-label {
            font-weight: 600;
            font-size: 14px;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #f0f0f0;
        }
        
        .btn {
            padding: 14px 32px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-secondary {
            background: white;
            color: #666;
            border: 2px solid #e0e0e0;
        }
        
        .btn-secondary:hover {
            background: #f5f5f5;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .skip-link {
            text-align: center;
            margin-top: 20px;
        }
        
        .skip-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .welcome-message {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .success-animation {
            font-size: 72px;
            margin-bottom: 20px;
            animation: bounce 1s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @media (max-width: 768px) {
            .preference-cards {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .step-indicator {
                gap: 15px;
            }
            
            .step-text {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="onboarding-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 25%;"></div>
        </div>
        
        <div class="onboarding-header">
            <div class="logo">üè†</div>
            <div class="step-indicator">
                <div class="step active" id="step1-indicator">
                    <div class="step-number">1</div>
                    <span class="step-text">Profile</span>
                </div>
                <div class="step" id="step2-indicator">
                    <div class="step-number">2</div>
                    <span class="step-text">Preferences</span>
                </div>
                <div class="step" id="step3-indicator">
                    <div class="step-number">3</div>
                    <span class="step-text">Goals</span>
                </div>
                <div class="step" id="step4-indicator">
                    <div class="step-number">‚úì</div>
                    <span class="step-text">Complete</span>
                </div>
            </div>
        </div>
        
        <div class="onboarding-content">
            <!-- Step 1: Profile Information -->
            <div class="step-content active" id="step1">
                <h2 class="step-title">Let's complete your profile</h2>
                <p class="step-subtitle">Help us personalize your experience</p>
                
                <div class="form-group">
                    <label for="location">Preferred Location</label>
                    <input type="text" id="location" placeholder="e.g., Philadelphia, PA" value="Philadelphia, PA">
                </div>
                
                <div class="form-group">
                    <label for="budget">Budget Range</label>
                    <div class="price-range">
                        <input type="number" id="minBudget" placeholder="Min price" value="200000">
                        <input type="number" id="maxBudget" placeholder="Max price" value="500000">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="timeframe">When are you looking to buy/sell?</label>
                    <select id="timeframe">
                        <option value="">Select timeframe</option>
                        <option value="asap">As soon as possible</option>
                        <option value="1-3months">1-3 months</option>
                        <option value="3-6months">3-6 months</option>
                        <option value="6-12months">6-12 months</option>
                        <option value="browsing">Just browsing</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Property Types of Interest</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="type-house" checked>
                            <label for="type-house">Single Family Home</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="type-condo">
                            <label for="type-condo">Condo/Townhouse</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="type-multi">
                            <label for="type-multi">Multi-Family</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="type-investment">
                            <label for="type-investment">Investment Property</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Preferences -->
            <div class="step-content" id="step2">
                <h2 class="step-title">What matters most to you?</h2>
                <p class="step-subtitle">Select up to 3 priorities</p>
                
                <div class="preference-cards">
                    <div class="preference-card" data-preference="schools">
                        <div class="preference-icon">üéì</div>
                        <div class="preference-label">School Districts</div>
                    </div>
                    <div class="preference-card" data-preference="transit">
                        <div class="preference-icon">üöá</div>
                        <div class="preference-label">Public Transit</div>
                    </div>
                    <div class="preference-card" data-preference="shopping">
                        <div class="preference-icon">üõçÔ∏è</div>
                        <div class="preference-label">Shopping & Dining</div>
                    </div>
                    <div class="preference-card" data-preference="parks">
                        <div class="preference-icon">üå≥</div>
                        <div class="preference-label">Parks & Recreation</div>
                    </div>
                    <div class="preference-card" data-preference="quiet">
                        <div class="preference-icon">üèòÔ∏è</div>
                        <div class="preference-label">Quiet Neighborhood</div>
                    </div>
                    <div class="preference-card" data-preference="nightlife">
                        <div class="preference-icon">üåÉ</div>
                        <div class="preference-label">Nightlife & Entertainment</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="bedrooms">Minimum Bedrooms</label>
                    <select id="bedrooms">
                        <option value="">Any</option>
                        <option value="1">1+</option>
                        <option value="2">2+</option>
                        <option value="3" selected>3+</option>
                        <option value="4">4+</option>
                        <option value="5">5+</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="bathrooms">Minimum Bathrooms</label>
                    <select id="bathrooms">
                        <option value="">Any</option>
                        <option value="1">1+</option>
                        <option value="2" selected>2+</option>
                        <option value="3">3+</option>
                        <option value="4">4+</option>
                    </select>
                </div>
            </div>
            
            <!-- Step 3: Goals -->
            <div class="step-content" id="step3">
                <h2 class="step-title">Tell us about your goals</h2>
                <p class="step-subtitle">How can we help you succeed?</p>
                
                <div class="form-group">
                    <label>Are you interested in our Micro-Flipping opportunities?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" name="microflip" id="microflip-yes" value="yes">
                            <label for="microflip-yes">Yes, show me investment opportunities</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" name="microflip" id="microflip-no" value="no">
                            <label for="microflip-no">No, I'm focused on traditional buying/selling</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="notes">Additional notes or requirements (optional)</label>
                    <textarea id="notes" placeholder="Tell us anything specific you're looking for..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Communication Preferences</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="email-updates" checked>
                            <label for="email-updates">Email updates about new properties</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="sms-alerts">
                            <label for="sms-alerts">SMS alerts for urgent opportunities</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="newsletter" checked>
                            <label for="newsletter">Weekly market insights newsletter</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="agent-contact">
                            <label for="agent-contact">Allow agents to contact me</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 4: Complete -->
            <div class="step-content" id="step4">
                <div class="success-animation">üéâ</div>
                <h2 class="step-title">Welcome to Assiduous!</h2>
                <p class="step-subtitle">Your profile is all set up</p>
                
                <div class="welcome-message">
                    <h3 style="font-size: 24px; margin-bottom: 15px;">You're ready to start!</h3>
                    <p style="font-size: 16px; opacity: 0.95;">We've personalized your experience based on your preferences. Our AI is already searching for perfect matches!</p>
                </div>
                
                <div style="text-align: center; margin: 40px 0;">
                    <h3 style="margin-bottom: 20px; color: #333;">What would you like to do first?</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 500px; margin: 0 auto;">
                        <button class="btn btn-primary" onclick="window.location.href='/client/properties.html'">
                            Browse Properties
                        </button>
                        <button class="btn btn-primary" onclick="window.location.href='/client/micro-flip-calculator.html'">
                            Try ROI Calculator
                        </button>
                        <button class="btn btn-primary" onclick="window.location.href='/client/saved.html'">
                            View Saved Properties
                        </button>
                        <button class="btn btn-primary" onclick="window.location.href='/client/dashboard.html'">
                            Go to Dashboard
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="btn btn-secondary" id="backBtn" onclick="previousStep()" style="display: none;">
                    Back
                </button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                    Continue
                </button>
            </div>
            
            <div class="skip-link" id="skipLink">
                <a href="/client/dashboard.html">Skip for now</a>
            </div>
        </div>
    </div>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCzPcEJ0TPKnJtcVT2qymgJrII1p0vAJxs",
            authDomain: "assiduous-prod.firebaseapp.com",
            projectId: "assiduous-prod",
            storageBucket: "assiduous-prod.appspot.com",
            messagingSenderId: "594472642287",
            appId: "1:594472642287:web:adf723a456b123c4567890"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        let currentStep = 1;
        const totalSteps = 4;
        let selectedPreferences = new Set();
        let profileData = {};
        
        // Handle preference card selection
        document.querySelectorAll('.preference-card').forEach(card => {
            card.addEventListener('click', function() {
                if (this.classList.contains('selected')) {
                    this.classList.remove('selected');
                    selectedPreferences.delete(this.dataset.preference);
                } else if (selectedPreferences.size < 3) {
                    this.classList.add('selected');
                    selectedPreferences.add(this.dataset.preference);
                } else {
                    alert('You can select up to 3 preferences');
                }
            });
        });
        
        // Handle checkbox item clicks
        document.querySelectorAll('.checkbox-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if (e.target === this) {
                    const checkbox = this.querySelector('input[type="checkbox"], input[type="radio"]');
                    if (checkbox) {
                        checkbox.checked = !checkbox.checked;
                        this.classList.toggle('selected', checkbox.checked);
                    }
                }
            });
        });
        
        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show current step
            document.getElementById(`step${step}`).classList.add('active');
            
            // Update step indicators
            for (let i = 1; i <= totalSteps; i++) {
                const indicator = document.getElementById(`step${i}-indicator`);
                indicator.classList.remove('active', 'completed');
                
                if (i < step) {
                    indicator.classList.add('completed');
                } else if (i === step) {
                    indicator.classList.add('active');
                }
            }
            
            // Update progress bar
            const progress = (step / totalSteps) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            // Update navigation buttons
            const backBtn = document.getElementById('backBtn');
            const nextBtn = document.getElementById('nextBtn');
            const skipLink = document.getElementById('skipLink');
            
            if (step === 1) {
                backBtn.style.display = 'none';
            } else {
                backBtn.style.display = 'block';
            }
            
            if (step === totalSteps) {
                nextBtn.style.display = 'none';
                backBtn.style.display = 'none';
                skipLink.style.display = 'none';
            } else if (step === totalSteps - 1) {
                nextBtn.textContent = 'Complete Setup';
            } else {
                nextBtn.textContent = 'Continue';
            }
        }
        
        function collectStepData(step) {
            switch(step) {
                case 1:
                    profileData.location = document.getElementById('location').value;
                    profileData.minBudget = document.getElementById('minBudget').value;
                    profileData.maxBudget = document.getElementById('maxBudget').value;
                    profileData.timeframe = document.getElementById('timeframe').value;
                    profileData.propertyTypes = [];
                    if (document.getElementById('type-house').checked) profileData.propertyTypes.push('house');
                    if (document.getElementById('type-condo').checked) profileData.propertyTypes.push('condo');
                    if (document.getElementById('type-multi').checked) profileData.propertyTypes.push('multi-family');
                    if (document.getElementById('type-investment').checked) profileData.propertyTypes.push('investment');
                    break;
                    
                case 2:
                    profileData.preferences = Array.from(selectedPreferences);
                    profileData.minBedrooms = document.getElementById('bedrooms').value;
                    profileData.minBathrooms = document.getElementById('bathrooms').value;
                    break;
                    
                case 3:
                    profileData.interestedInMicroFlipping = document.querySelector('input[name="microflip"]:checked')?.value || 'no';
                    profileData.notes = document.getElementById('notes').value;
                    profileData.emailUpdates = document.getElementById('email-updates').checked;
                    profileData.smsAlerts = document.getElementById('sms-alerts').checked;
                    profileData.newsletter = document.getElementById('newsletter').checked;
                    profileData.agentContact = document.getElementById('agent-contact').checked;
                    break;
            }
        }
        
        async function saveProfile() {
            if (auth.currentUser) {
                try {
                    await db.collection('users').doc(auth.currentUser.uid).update({
                        ...profileData,
                        profileComplete: true,
                        onboardingCompleted: new Date().toISOString()
                    });
                    
                    // Also save to preferences subcollection
                    await db.collection('users').doc(auth.currentUser.uid)
                        .collection('preferences').doc('search').set({
                            location: profileData.location,
                            minBudget: parseInt(profileData.minBudget),
                            maxBudget: parseInt(profileData.maxBudget),
                            minBedrooms: parseInt(profileData.minBedrooms) || 0,
                            minBathrooms: parseInt(profileData.minBathrooms) || 0,
                            propertyTypes: profileData.propertyTypes,
                            priorities: profileData.preferences,
                            updatedAt: new Date().toISOString()
                        });
                    
                    console.log('Profile saved successfully');
                } catch (error) {
                    console.error('Error saving profile:', error);
                }
            }
            
            // Save to localStorage as well
            localStorage.setItem('userPreferences', JSON.stringify(profileData));
            localStorage.setItem('onboardingComplete', 'true');
        }
        
        async function nextStep() {
            // Collect data from current step
            collectStepData(currentStep);
            
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
                
                // Save profile when reaching completion
                if (currentStep === totalSteps) {
                    await saveProfile();
                }
            }
        }
        
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }
        
        // Check if user is logged in
        auth.onAuthStateChanged((user) => {
            if (!user) {
                // Redirect to login if not authenticated
                window.location.href = '/auth/login.html';
            } else {
                // Check if onboarding is already complete
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (doc.exists && doc.data().profileComplete) {
                        // Already completed onboarding
                        window.location.href = '/client/dashboard.html';
                    }
                });
            }
        });
    </script>
</body>
</html>