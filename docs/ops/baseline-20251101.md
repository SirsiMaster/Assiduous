# AssiduousFlip Baseline Snapshot - November 1, 2025

## Executive Summary
Snapshot taken before major cleanup and refactoring to enable rollback if needed.
- **Date**: November 1, 2025, 5:45 PM UTC
- **Repository**: /Users/thekryptodragon/Development/assiduous
- **Current Branch**: main
- **Production URL**: https://www.assiduousflip.com
- **Staging URL**: https://assiduous-staging.web.app

## Local Repository Status

### Current Branch Status
- **Active Branch**: main
- **Sync Status**: Up to date with origin/main
- **Uncommitted Changes**: 4 files modified
  - firebase-migration-package/assiduous-build/.firebase/hosting..cache
  - firebase-migration-package/assiduous-build/admin/development/metrics_cache.json
  - functions/src/index.ts
  - metrics_cache_enhanced.json

### Repository Branches
**Local Branches**:
- main (active)
- staging
- chore/audit-fix
- hotfix/landing-revert

**Remote Branches**:
- origin/main
- origin/staging
- origin/chore/audit-fix
- origin/dependabot/npm_and_yarn/* (multiple)

## Firebase Project Status

### Projects
1. **assiduous-prod** (current) - Project Number: 9355377564
2. **assiduous-staging** - Project Number: 853661742177
3. **sirsi-nexus-live** - Project Number: 210890802638

### Deployed Functions (Production)
All functions are v2 in us-central1 region with nodejs22 runtime:
- `api` - HTTP trigger (main API endpoint)
- `bulkDeleteProperties` - HTTP trigger
- `createApiKey` - Callable function
- `ingestProperty` - HTTP trigger
- `onLeadCreated` - HTTP trigger
- `onNewUserCreated` - Auth trigger (beforeCreate)
- `onUserProfileCreated` - HTTP trigger

### Hosting Status
- **Production**: assiduous-prod.web.app, www.assiduousflip.com
- **Staging**: assiduous-staging.web.app

## Critical Issues Identified

### 1. Authentication System
- Firebase SDK loading order issue causing "firebase is not defined" errors
- Using compat SDK instead of modular SDK
- Global firebase usage throughout codebase

### 2. API Services
- SendGrid, Twilio, Stripe secrets configured but not working
- Need to verify secret attachment to v2 functions
- Missing proper error handling and logging

### 3. Repository Structure
- Multiple source directories causing confusion
- Uncommitted changes in cache and metrics files
- Need clear separation between source and build directories

### 4. Mock Data Dependencies
- All portals using mock data instead of Firestore
- No real-time data connections implemented
- CRUD operations not persisting

## Risk Assessment

### High Risk
1. Uncommitted changes in functions/src/index.ts
2. Firebase initialization errors blocking all functionality
3. Production and staging drift

### Medium Risk
1. Multiple dependabot branches pending
2. Cache files being tracked in git
3. Unclear source of truth for deployments

### Low Risk
1. Documentation files out of sync
2. Legacy branches not cleaned up

## Rollback Plan

### If Cleanup Fails
1. Stash current changes: `git stash save "cleanup-attempt-20251101"`
2. Reset to this commit: `git reset --hard HEAD`
3. Restore stashed changes if needed: `git stash pop`
4. Force deploy last known good: `firebase deploy --only hosting --project assiduous-prod`

### Firebase Rollback
1. Functions: Use Firebase Console to roll back to previous version
2. Hosting: Deploy previous build from git history
3. Firestore Rules: Restore from version history in console

## Next Steps
1. Create salvage branch for uncommitted work
2. Clean up repository structure
3. Fix Firebase initialization to use modular SDK
4. Implement proper authentication flow
5. Connect portals to real Firestore data
6. Verify SendGrid, Twilio, Stripe integrations

## Success Criteria
- Zero console errors in browser
- Authentication working with role-based redirects
- All CRUD operations persisting to Firestore
- Email/SMS notifications triggering correctly
- Clean git status with protected branches